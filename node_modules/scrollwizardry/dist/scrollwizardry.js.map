{"version":3,"file":"scrollwizardry.js","sources":["../src/Util.js","../src/Event.js","../src/Log.js","../src/Indicator.js","../src/Scene.js","../src/Controller.js","../src/index.js"],"sourcesContent":["/* eslint-env browser */\n\nimport _ from 'lodash';\n\nclass Util {\n  static elements(selector = []) {\n    if (_.isString(selector)) {\n      return document.querySelectorAll(selector);\n    }\n    if (_.isElement(selector) || selector === document || selector === window) {\n      return [selector];\n    }\n    return selector;\n  }\n  static scrollTop(el = {}) {\n    return el.scrollTop || window.pageYOffset || 0;\n  }\n  static scrollLeft(el = {}) {\n    return el.scrollLeft || window.pageXOffset || 0;\n  }\n  static width(el) {\n    if (el === window) {\n      return window.innerWidth;\n    }\n    return el.getBoundingClientRect().width;\n  }\n  static height(el) {\n    if (el === window) {\n      return window.innerHeight;\n    }\n    return el.getBoundingClientRect().height;\n  }\n  static offset(el, relativeToViewport) {\n    const offset = { top: 0, left: 0 };\n    if (el && el.getBoundingClientRect) {\n      const rect = el.getBoundingClientRect();\n      offset.top = rect.top;\n      offset.left = rect.left;\n      if (!relativeToViewport) {\n        offset.top += Util.scrollTop();\n        offset.left += Util.scrollLeft();\n      }\n    }\n    return offset;\n  }\n  static marginCollapse(display) {\n    return ['block', 'flex', 'list-item', 'table', '-webkit-box'].includes(display);\n  }\n  static css(el, css) {\n    if (!css) {\n      return el.currentStyle ? el.currentStyle : window.getComputedStyle(el);\n    }\n\n    _.forEach(css, (value, key) => {\n      if (value === parseFloat(value)) { // assume pixel for seemingly numerical values\n        value += 'px';\n      }\n      el.style[_.camelCase(key)] = value;\n    });\n\n    return css;\n  }\n}\n\nexport default Util;\n","class Event {\n  constructor(type, namespace, target, vars) {\n    vars = vars || {};\n    for (const key in vars) {\n      this[key] = vars[key];\n    }\n    this.type = type;\n    this.target = target;\n    this.currentTarget = target;\n    this.namespace = namespace || '';\n    this.timeStamp = Date.now();\n    this.timestamp = this.timeStamp;\n    return this;\n  }\n}\n\nexport default Event;\n","const DEBUG = false;\nconst LOG_LEVELS = ['error', 'warn', 'log'];\n\nclass Log {\n  static log(loglevel) {\n    if (!DEBUG) {\n      return;\n    }\n    if (loglevel > LOG_LEVELS.length || loglevel <= 0) loglevel = LOG_LEVELS.length;\n    const now = new Date();\n    const time = `${(`0${now.getHours()}`).slice(-2)}:${(`0${now.getMinutes()}`).slice(-2)}:${(`0${now.getSeconds()}`).slice(-2)}:${(`00${now.getMilliseconds()}`).slice(-3)}`;\n    const method = LOG_LEVELS[loglevel - 1];\n    const args = Array.prototype.splice.call(arguments, 1);\n    const func = Function.prototype.bind.call(console[method], console);\n    args.unshift(time);\n    func.apply(console, args);\n  }\n}\n\nexport default Log;\n","/* eslint-env browser */\n\nimport _ from 'lodash';\nimport Util from './Util';\nimport Log from './Log';\n\nconst FONT_SIZE = '0.85em';\nconst ZINDEX = '9999';\n\nconst TPL = {\n  start(color) {\n    // inner element (for bottom offset -1, while keeping top position 0)\n    const inner = document.createElement('div');\n    inner.textContent = 'start';\n    Util.css(inner, {\n      position: 'absolute',\n      overflow: 'visible',\n      'border-width': 0,\n      'border-style': 'solid',\n      color,\n      'border-color': color,\n    });\n    const element = document.createElement('div');\n    // wrapper\n    Util.css(element, {\n      position: 'absolute',\n      overflow: 'visible',\n      width: 0,\n      height: 0,\n    });\n    element.appendChild(inner);\n    return element;\n  },\n  end(color) {\n    const element = document.createElement('div');\n    element.textContent = 'end';\n    Util.css(element, {\n      position: 'absolute',\n      overflow: 'visible',\n      'border-width': 0,\n      'border-style': 'solid',\n      color,\n      'border-color': color,\n    });\n    return element;\n  },\n  bounds() {\n    const element = document.createElement('div');\n    Util.css(element, {\n      position: 'absolute',\n      overflow: 'visible',\n      'white-space': 'nowrap',\n      'pointer-events': 'none',\n      'font-size': FONT_SIZE,\n    });\n    element.style.zIndex = ZINDEX;\n    return element;\n  },\n  trigger(color) {\n    // inner to be above or below line but keep position\n    const inner = document.createElement('div');\n    inner.textContent = 'trigger';\n    Util.css(inner, {\n      position: 'relative',\n    });\n    // wrapper for right: 0 and main element has no size\n    const wrapper = document.createElement('div');\n    Util.css(wrapper, {\n      position: 'absolute',\n      overflow: 'visible',\n      'border-width': 0,\n      'border-style': 'solid',\n      color,\n      'border-color': color,\n    });\n    wrapper.appendChild(inner);\n    // element\n    const element = document.createElement('div');\n    Util.css(element, {\n      position: 'fixed',\n      overflow: 'visible',\n      'white-space': 'nowrap',\n      'pointer-events': 'none',\n      'font-size': FONT_SIZE,\n    });\n    element.style.zIndex = ZINDEX;\n    element.appendChild(wrapper);\n    return element;\n  },\n};\n\nlet _autoindex = 0;\n\nclass Indicator {\n  constructor(scene, options) {\n    const DEFAULT_INDICATOR_OPTIONS = {\n      name: '',\n      indent: 0,\n      parent: undefined,\n      colorStart: 'green',\n      colorEnd: 'red',\n      colorTrigger: 'blue',\n    };\n\n    options = _.merge({}, DEFAULT_INDICATOR_OPTIONS, options);\n\n    options.name = options.name || _autoindex;\n\n    _autoindex++;\n\n    this._elemBounds = TPL.bounds();\n    this._elemStart = TPL.start(options.colorStart);\n    this._elemEnd = TPL.end(options.colorEnd);\n\n    this._boundsContainer = options.parent && Util.elements(options.parent)[0];\n\n    // prepare bounds elements\n    this._elemStart.firstChild.textContent += ` ${options.name}`;\n    this._elemEnd.textContent += ` ${options.name}`;\n    this._elemBounds.appendChild(this._elemStart);\n    this._elemBounds.appendChild(this._elemEnd);\n\n    this._vertical = null;\n    this._ctrl = null;\n\n    // set public variables\n    this.options = options;\n    this.bounds = this._elemBounds;\n    this.triggerGroup = null; // will be set later\n\n    this.scene = scene;\n  }\n\n  // add indicators to DOM\n  add() {\n    this._ctrl = this.scene.controller();\n    this._vertical = this._ctrl.info('vertical');\n\n    const isDocument = this._ctrl.info('isDocument');\n\n    if (!this._boundsContainer) {\n      // no parent supplied or doesnt exist\n      this._boundsContainer = isDocument ? document.body : this._ctrl.info('container'); // check if window/document (then use body)\n    }\n    if (!isDocument && Util.css(this._boundsContainer).position === 'static') {\n      // position mode needed for correct positioning of indicators\n      Util.css(this._boundsContainer, { position: 'relative' });\n    }\n\n    // add listeners for updates\n    this.scene.on('change.plugin_addIndicators', this._handleTriggerParamsChange.bind(this));\n    this.scene.on('shift.plugin_addIndicators', this._handleBoundsParamsChange.bind(this));\n\n    // updates trigger & bounds (will add elements if needed)\n    this._updateTriggerGroup();\n    this._updateBounds();\n\n    setTimeout(() => { // do after all execution is finished otherwise sometimes size calculations are off\n      this._ctrl.updateBoundsPositions(this);\n    }, 0);\n\n    Log.log(3, 'added indicators');\n  }\n\n  // remove indicators from DOM\n  remove() {\n    if (this.triggerGroup) { // if not set there's nothing to remove\n      this.scene.off('change.plugin_addIndicators', this._handleTriggerParamsChange);\n      this.scene.off('shift.plugin_addIndicators', this._handleBoundsParamsChange);\n\n      if (this.triggerGroup.members.length > 1) {\n        // just remove from memberlist of old group\n        const group = this.triggerGroup;\n        group.members.splice(group.members.indexOf(this), 1);\n        this._ctrl.updateTriggerGroupLabel(group);\n        this._ctrl.updateTriggerGroupPositions(group);\n        this.triggerGroup = null;\n      } else {\n        // remove complete group\n        this._removeTriggerGroup();\n      }\n      this._removeBounds();\n\n      Log.log(3, 'removed indicators');\n    }\n  }\n\n  // event handler for when bounds params change\n  _handleBoundsParamsChange() {\n    this._updateBounds();\n  }\n\n  // event handler for when trigger params change\n  _handleTriggerParamsChange(event) {\n    if (event.what === 'triggerHook') {\n      this._updateTriggerGroup();\n    }\n  }\n\n  // adds an new bounds elements to the array and to the DOM\n  _addBounds() {\n    const v = this._ctrl.info('vertical');\n    // apply stuff we didn't know before...\n    Util.css(this._elemStart.firstChild, {\n      'border-bottom-width': v ? 1 : 0,\n      'border-right-width': v ? 0 : 1,\n      bottom: v ? -1 : this.options.indent,\n      right: v ? this.options.indent : -1,\n      padding: v ? '0 8px' : '2px 4px',\n    });\n    Util.css(this._elemEnd, {\n      'border-top-width': v ? 1 : 0,\n      'border-left-width': v ? 0 : 1,\n      top: v ? '100%' : '',\n      right: v ? this.options.indent : '',\n      bottom: v ? '' : this.options.indent,\n      left: v ? '' : '100%',\n      padding: v ? '0 8px' : '2px 4px',\n    });\n    // append\n    this._boundsContainer.appendChild(this._elemBounds);\n  }\n\n  // remove bounds from list and DOM\n  _removeBounds() {\n    this._elemBounds.parentNode.removeChild(this._elemBounds);\n  }\n\n  // update the start and end positions of the scene\n  _updateBounds() {\n    if (this._elemBounds.parentNode !== this._boundsContainer) {\n      this._addBounds(); // Add Bounds elements (start/end)\n    }\n    const css = {};\n    css[this._vertical ? 'top' : 'left'] = this.scene.triggerPosition();\n    css[this._vertical ? 'height' : 'width'] = this.scene.duration();\n    Util.css(this._elemBounds, css);\n    Util.css(this._elemEnd, {\n      display: this.scene.duration() > 0 ? '' : 'none',\n    });\n  }\n\n  // adds an new trigger group to the array and to the DOM\n  _addTriggerGroup() {\n    const triggerElem = TPL.trigger(this.options.colorTrigger); // new trigger element\n    const css = {};\n    css[this._vertical ? 'right' : 'bottom'] = 0;\n    css[this._vertical ? 'border-top-width' : 'border-left-width'] = 1;\n    Util.css(triggerElem.firstChild, css);\n    Util.css(triggerElem.firstChild.firstChild, {\n      padding: this._vertical ? '0 8px 3px 8px' : '3px 4px',\n    });\n    document.body.appendChild(triggerElem); // directly add to body\n    const newGroup = {\n      triggerHook: this.scene.triggerHook(),\n      element: triggerElem,\n      members: [this],\n    };\n    this._ctrl._indicators.groups.push(newGroup);\n    this.triggerGroup = newGroup;\n    // update right away\n    this._ctrl.updateTriggerGroupLabel(newGroup);\n    this._ctrl.updateTriggerGroupPositions(newGroup);\n  }\n\n  _removeTriggerGroup() {\n    this._ctrl._indicators.groups.splice(this._ctrl._indicators.groups.indexOf(this.triggerGroup), 1);\n    this.triggerGroup.element.parentNode.removeChild(this.triggerGroup.element);\n    this.triggerGroup = null;\n  }\n\n  // updates the trigger group -> either join existing or add new one\n  _updateTriggerGroup() {\n    const triggerHook = this.scene.triggerHook();\n    const closeEnough = 0.0001;\n\n    // Have a group, check if it still matches\n    if (this.triggerGroup) {\n      if (Math.abs(this.triggerGroup.triggerHook - triggerHook) < closeEnough) {\n        // Log.log(0, \"trigger\", options.name, \"->\", \"no need to change, still in sync\");\n        return; // all good\n      }\n    }\n\n    // Don't have a group, check if a matching one exists\n    // Log.log(0, \"trigger\", options.name, \"->\", \"out of sync!\");\n    const groups = this._ctrl._indicators.groups;\n    let group;\n    let i = groups.length;\n\n    while (i--) {\n      group = groups[i];\n      if (Math.abs(group.triggerHook - triggerHook) < closeEnough) {\n        // found a match!\n        // Log.log(0, \"trigger\", options.name, \"->\", \"found match\");\n        if (this.triggerGroup) { // do I have an old group that is out of sync?\n          if (this.triggerGroup.members.length === 1) { // is it the only remaining group?\n            // Log.log(0, \"trigger\", options.name, \"->\", \"kill\");\n            // was the last member, remove the whole group\n            this._removeTriggerGroup();\n          } else {\n            this.triggerGroup.members.splice(this.triggerGroup.members.indexOf(this), 1); // just remove from memberlist of old group\n            this._ctrl.updateTriggerGroupLabel(this.triggerGroup);\n            this._ctrl.updateTriggerGroupPositions(this.triggerGroup);\n            // Log.log(0, \"trigger\", options.name, \"->\", \"removing from previous member list\");\n          }\n        }\n        // join new group\n        group.members.push(this);\n        this.triggerGroup = group;\n        this._ctrl.updateTriggerGroupLabel(group);\n        return;\n      }\n    }\n\n    // at this point I am obviously out of sync and don't match any other group\n    if (this.triggerGroup) {\n      if (this.triggerGroup.members.length === 1) {\n        // Log.log(0, \"trigger\", options.name, \"->\", \"updating existing\");\n        // out of sync but i'm the only member => just change and update\n        this.triggerGroup.triggerHook = triggerHook;\n        this._ctrl.updateTriggerGroupPositions(this.triggerGroup);\n        return;\n      }\n      // Log.log(0, \"trigger\", options.name, \"->\", \"removing from previous member list\");\n      this.triggerGroup.members.splice(this.triggerGroup.members.indexOf(this), 1); // just remove from memberlist of old group\n      this._ctrl.updateTriggerGroupLabel(this.triggerGroup);\n      this._ctrl.updateTriggerGroupPositions(this.triggerGroup);\n      this.triggerGroup = null; // need a brand new group...\n    }\n    // Log.log(0, \"trigger\", options.name, \"->\", \"add a new one\");\n    // did not find any match, make new trigger group\n    this._addTriggerGroup();\n  }\n}\n\nexport default Indicator;\n","/* eslint-env browser */\r\n\r\nimport _ from 'lodash';\r\nimport Util from './Util';\r\nimport Event from './Event';\r\nimport Indicator from './Indicator';\r\nimport Log from './Log';\r\n\r\nconst PIN_SPACER_ATTRIBUTE = 'data-scrollwizardry-pin-spacer';\r\n\r\nconst NAMESPACE = 'ScrollWizardry.Scene';\r\n\r\nconst SCENE_STATE_BEFORE = 'BEFORE';\r\nconst SCENE_STATE_DURING = 'DURING';\r\nconst SCENE_STATE_AFTER = 'AFTER';\r\n\r\n// list of options that trigger a `shift` event\r\nconst SHIFTS = ['duration', 'offset', 'triggerHook'];\r\n\r\nconst DEFAULT_SCENE_OPTIONS = {\r\n  duration: 0,\r\n  offset: 0,\r\n  triggerElement: undefined,\r\n  triggerHook: 0.5,\r\n  reverse: true,\r\n  loglevel: 2,\r\n  tweenChanges: false,\r\n};\r\n\r\nclass Scene {\r\n  constructor(options) {\r\n    this.options = _.merge({}, DEFAULT_SCENE_OPTIONS, options);\r\n\r\n    this._state = SCENE_STATE_BEFORE;\r\n    this._progress = 0;\r\n    this._scrollOffset = { start: 0, end: 0 };\r\n    this._triggerPos = 0;\r\n    this._durationUpdateMethod = null;\r\n    this._controller = null;\r\n    this._listeners = {};\r\n\r\n    this._pin = null;\r\n    this._pinOptions = null;\r\n\r\n    this._cssClasses = null;\r\n    this._cssClassElems = [];\r\n\r\n    this._tween = null;\r\n\r\n    this._indicator = null;\r\n\r\n    // add getters/setters for all possible options\r\n    Object.keys(DEFAULT_SCENE_OPTIONS).forEach((optionName) => {\r\n      this._addSceneOption(optionName);\r\n    });\r\n\r\n    this.validate = {\r\n      duration(val) {\r\n        if (_.isString(val) && val.match(/^(\\.|\\d)*\\d+%$/)) {\r\n        // percentage value\r\n          const perc = parseFloat(val) / 100;\r\n          val = () => (this._controller ? this._controller.info('size') * perc : 0);\r\n        }\r\n        if (_.isFunction(val)) {\r\n        // function\r\n          this._durationUpdateMethod = val;\r\n          try {\r\n            val = parseFloat(this._durationUpdateMethod());\r\n          } catch (error) {\r\n            val = -1; // will cause error below\r\n          }\r\n        }\r\n        // val has to be float\r\n        val = parseFloat(val);\r\n        if (!_.isNumber(val) || val < 0) {\r\n          if (this._durationUpdateMethod) {\r\n            this._durationUpdateMethod = null;\r\n            throw Error(`Invalid return value of supplied function for option \"duration\": ${val}`);\r\n          } else {\r\n            throw Error(`Invalid value for option \"duration\": ${val}`);\r\n          }\r\n        }\r\n        return val;\r\n      },\r\n      offset(val) {\r\n        if (_.isFunction(val)) {\r\n          val = val();\r\n        }\r\n        val = parseFloat(val);\r\n        if (!_.isNumber(val)) {\r\n          throw Error(`Invalid value for option \"offset\": ${val}`);\r\n        }\r\n        return val;\r\n      },\r\n      triggerElement(val) {\r\n        val = val || undefined;\r\n        if (val) {\r\n          const el = _.isString(val) ? Util.elements(val)[0] : val;\r\n          if (el && el.parentNode) {\r\n            val = el;\r\n          } else {\r\n            throw Error(`Element defined in option \"triggerElement\" was not found: ${val}`);\r\n          }\r\n        }\r\n        return val;\r\n      },\r\n      triggerHook(val) {\r\n        const translate = { onCenter: 0.5, onEnter: 1, onLeave: 0 };\r\n        if (_.isNumber(val)) {\r\n          val = Math.max(0, Math.min(parseFloat(val), 1)); //  make sure its betweeen 0 and 1\r\n        } else if (val in translate) {\r\n          val = translate[val];\r\n        } else {\r\n          throw Error(`Invalid value for option \"triggerHook\": ${val}`);\r\n        }\r\n        return val;\r\n      },\r\n      reverse(val) {\r\n        return !!val; // force boolean\r\n      },\r\n      loglevel(val) {\r\n        val = parseInt(val, 10);\r\n        if (!_.isNumber(val) || val < 0 || val > 3) {\r\n          throw Error(`Invalid value for option \"loglevel\": ${val}`);\r\n        }\r\n        return val;\r\n      },\r\n      tweenChanges(val) {\r\n        return !!val;\r\n      },\r\n    };\r\n\r\n    // validate all options\r\n    this._validateOption();\r\n\r\n    this.on('change.internal', (event) => {\r\n      if (event.what !== 'loglevel' && event.what !== 'tweenChanges') { // no need for a scene update scene with these options...\r\n        if (event.what === 'triggerElement') {\r\n          this._updateTriggerElementPosition();\r\n        } else if (event.what === 'reverse') { // the only property left that may have an impact on the current scene state. Everything else is handled by the shift event.\r\n          this.update();\r\n        }\r\n      }\r\n    });\r\n\r\n    this.on('shift.internal', (event) => {\r\n      this.update(); // update scene to reflect new position\r\n    });\r\n\r\n    // pinning\r\n\r\n    this.on('shift.internal', (event) => {\r\n      const durationChanged = event.reason === 'duration';\r\n      if ((this._state === SCENE_STATE_AFTER && durationChanged) || (this._state === SCENE_STATE_DURING && this.options.duration === 0)) {\r\n        // if [duration changed after a scene (inside scene progress updates pin position)] or [duration is 0, we are in pin phase and some other value changed].\r\n        this._updatePinState();\r\n      }\r\n      if (durationChanged) {\r\n        this._updatePinDimensions();\r\n      }\r\n    });\r\n\r\n    this.on('progress.internal', (event) => {\r\n      this._updatePinState();\r\n    });\r\n\r\n    this.on('add.internal', (event) => {\r\n      this._updatePinDimensions();\r\n    });\r\n\r\n    this.on('destroy.internal', (event) => {\r\n      this.removePin(event.reset);\r\n    });\r\n\r\n    // class toggle\r\n\r\n    this.on('destroy.internal', (event) => {\r\n      this.removeClassToggle(event.reset);\r\n    });\r\n\r\n    // gsap\r\n\r\n    this.on('progress.plugin_gsap', () => {\r\n      this._updateTweenProgress();\r\n    });\r\n\r\n    this.on('destroy.plugin_gsap', (event) => {\r\n      this.removeTween(event.reset);\r\n    });\r\n  }\r\n\r\n  on(names, callback) {\r\n    if (_.isFunction(callback)) {\r\n      names = names.trim().split(' ');\r\n      names.forEach((fullname) => {\r\n        const nameparts = fullname.split('.');\r\n        const eventname = nameparts[0];\r\n        const namespace = nameparts[1];\r\n        if (eventname !== '*') { // disallow wildcards\r\n          if (!this._listeners[eventname]) {\r\n            this._listeners[eventname] = [];\r\n          }\r\n          this._listeners[eventname].push({\r\n            namespace: namespace || '',\r\n            callback,\r\n          });\r\n        }\r\n      });\r\n    } else {\r\n      Log.log(1, `ERROR when calling '.on()': Supplied callback for '${names}' is not a valid function!`);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  off(names, callback) {\r\n    if (!names) {\r\n      Log.log(1, 'ERROR: Invalid event name supplied.');\r\n      return this;\r\n    }\r\n    names = names.trim().split(' ');\r\n    names.forEach((fullname, key) => {\r\n      const nameparts = fullname.split('.');\r\n      const eventname = nameparts[0];\r\n      const namespace = nameparts[1] || '';\r\n      const removeList = eventname === '*' ? Object.keys(this._listeners) : [eventname];\r\n      removeList.forEach((remove) => {\r\n        const list = this._listeners[remove] || [];\r\n        let i = list.length;\r\n        while (i--) {\r\n          const listener = list[i];\r\n          if (listener && (namespace === listener.namespace || namespace === '*') && (!callback || callback === listener.callback)) {\r\n            list.splice(i, 1);\r\n          }\r\n        }\r\n        if (!list.length) {\r\n          delete this._listeners[remove];\r\n        }\r\n      });\r\n    });\r\n    return this;\r\n  }\r\n\r\n  trigger(name, vars) {\r\n    if (name) {\r\n      const nameparts = name.trim().split('.');\r\n      const eventname = nameparts[0];\r\n      const namespace = nameparts[1];\r\n      const listeners = this._listeners[eventname];\r\n      Log.log(3, 'event fired:', eventname, vars ? '->' : '', vars || '');\r\n      if (listeners) {\r\n        listeners.forEach((listener) => {\r\n          if (!namespace || namespace === listener.namespace) {\r\n            listener.callback.call(this, new Event(eventname, listener.namespace, this, vars));\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      Log.log(1, 'ERROR: Invalid event name supplied.');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  addTo(controller) {\r\n    if (this._controller !== controller) {\r\n      // new controller\r\n      if (this._controller) { // was associated to a different controller before, so remove it...\r\n        this._controller.removeScene(this);\r\n      }\r\n      this._controller = controller;\r\n      this._validateOption();\r\n      this._updateDuration(true);\r\n      this._updateTriggerElementPosition(true);\r\n      this._updateScrollOffset();\r\n      this._controller.info('container').addEventListener('resize', this._onContainerResize.bind(this), { passive: true });\r\n      controller.addScene(this);\r\n      this.trigger('add', { controller: this._controller });\r\n      Log.log(3, `added ${NAMESPACE} to controller`);\r\n      this.update();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  remove() {\r\n    if (this._controller) {\r\n      this._controller.info('container').removeEventListener('resize', this._onContainerResize.bind(this), { passive: true });\r\n      const tmpParent = this._controller;\r\n      this._controller = null;\r\n      tmpParent.removeScene(this);\r\n      this.trigger('remove');\r\n      Log.log(3, `removed ${NAMESPACE} from controller`);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  destroy(reset) {\r\n    this.trigger('destroy', { reset });\r\n    this.remove();\r\n    this.triggerElement(null);\r\n    this.off('*.*');\r\n    Log.log(3, `destroyed ${NAMESPACE} (reset: ${reset ? 'true' : 'false'})`);\r\n    return null;\r\n  }\r\n\r\n  update(immediately) {\r\n    if (this._controller) {\r\n      this._updateScrollOffset();\r\n      if (immediately) {\r\n        if (this._controller.enabled()) {\r\n          const scrollPos = this._controller.info('scrollPos');\r\n          let newProgress;\r\n\r\n          if (this.options.duration > 0) {\r\n            newProgress = (scrollPos - this._scrollOffset.start) / (this._scrollOffset.end - this._scrollOffset.start);\r\n          } else {\r\n            newProgress = scrollPos >= this._scrollOffset.start ? 1 : 0;\r\n          }\r\n\r\n          this.trigger('update', { startPos: this._scrollOffset.start, endPos: this._scrollOffset.end, scrollPos });\r\n\r\n          this.progress(newProgress);\r\n        } else if (this._pin && this._state === SCENE_STATE_DURING) {\r\n          this._updatePinState(true); // unpin in position\r\n        }\r\n      } else {\r\n        this._controller.updateScene(this, false);\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  refresh() {\r\n    this._updateDuration();\r\n    this._updateTriggerElementPosition();\r\n    // update trigger element position\r\n    return this;\r\n  }\r\n\r\n  progress(progress) {\r\n    if (!arguments.length) { // get\r\n      return this._progress;\r\n    } // set\r\n\r\n    let doUpdate = false;\r\n    const oldState = this._state;\r\n    const scrollDirection = this._controller ? this._controller.info('scrollDirection') : 'PAUSED';\r\n    const reverseOrForward = this.options.reverse || progress >= this._progress;\r\n    if (this.options.duration === 0) {\r\n      // zero duration scenes\r\n      doUpdate = this._progress !== progress;\r\n      this._progress = progress < 1 && reverseOrForward ? 0 : 1;\r\n      this._state = this._progress === 0 ? SCENE_STATE_BEFORE : SCENE_STATE_DURING;\r\n    } else {\r\n      // scenes with start and end\r\n      if (progress < 0 && this._state !== SCENE_STATE_BEFORE && reverseOrForward) {\r\n        // go back to initial state\r\n        this._progress = 0;\r\n        this._state = SCENE_STATE_BEFORE;\r\n        doUpdate = true;\r\n      } else if (progress >= 0 && progress < 1 && reverseOrForward) {\r\n        this._progress = progress;\r\n        this._state = SCENE_STATE_DURING;\r\n        doUpdate = true;\r\n      } else if (progress >= 1 && this._state !== SCENE_STATE_AFTER) {\r\n        this._progress = 1;\r\n        this._state = SCENE_STATE_AFTER;\r\n        doUpdate = true;\r\n      } else if (this._state === SCENE_STATE_DURING && !reverseOrForward) {\r\n        this._updatePinState(); // in case we scrolled backwards mid-scene and reverse is disabled => update the pin position, so it doesn't move back as well.\r\n      }\r\n    }\r\n    if (doUpdate) {\r\n      // fire events\r\n      const eventVars = { progress: this._progress, state: this._state, scrollDirection };\r\n      const stateChanged = this._state !== oldState;\r\n\r\n      const trigger = (eventName) => { // tmp helper to simplify code\r\n        this.trigger(eventName, eventVars);\r\n      };\r\n\r\n      if (stateChanged) { // enter events\r\n        if (oldState !== SCENE_STATE_DURING) {\r\n          trigger('enter');\r\n          trigger(oldState === SCENE_STATE_BEFORE ? 'start' : 'end');\r\n        }\r\n      }\r\n      trigger('progress');\r\n      if (stateChanged) { // leave events\r\n        if (this._state !== SCENE_STATE_DURING) {\r\n          trigger(this._state === SCENE_STATE_BEFORE ? 'start' : 'end');\r\n          trigger('leave');\r\n        }\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  _updateScrollOffset() {\r\n    const offset = _.isFunction(this.options.offset) ? this.options.offset() : this.options.offset;\r\n    this._scrollOffset = { start: this._triggerPos + offset };\r\n    if (this._controller && this.options.triggerElement) {\r\n      // take away triggerHook portion to get relative to top\r\n      this._scrollOffset.start -= this._controller.info('size') * this.options.triggerHook;\r\n    }\r\n    this._scrollOffset.end = this._scrollOffset.start + this.options.duration;\r\n  }\r\n\r\n  _updateDuration(suppressEvents) {\r\n    // update duration\r\n    if (this._durationUpdateMethod) {\r\n      const varname = 'duration';\r\n      if (this._changeOption(varname, this._durationUpdateMethod.call(this)) && !suppressEvents) { // set\r\n        this.trigger('change', { what: varname, newVal: this.options[varname] });\r\n        this.trigger('shift', { reason: varname });\r\n      }\r\n    }\r\n  }\r\n\r\n  _updateTriggerElementPosition(suppressEvents) {\r\n    let elementPos = 0;\r\n    let telem = this.options.triggerElement;\r\n    if (this._controller && (telem || this._triggerPos > 0)) { // either an element exists or was removed and the triggerPos is still > 0\r\n      if (telem) { // there currently a triggerElement set\r\n        if (telem.parentNode) { // check if element is still attached to DOM\r\n          const controllerInfo = this._controller.info();\r\n          const containerOffset = Util.offset(controllerInfo.container); // container position is needed because element offset is returned in relation to document, not in relation to container.\r\n          const param = controllerInfo.vertical ? 'top' : 'left'; // which param is of interest ?\r\n\r\n          // if parent is spacer, use spacer position instead so correct start position is returned for pinned elements.\r\n          while (telem.parentNode.hasAttribute(PIN_SPACER_ATTRIBUTE)) {\r\n            telem = telem.parentNode;\r\n          }\r\n\r\n          const elementOffset = Util.offset(telem);\r\n\r\n          if (!controllerInfo.isDocument) { // container is not the document root, so substract scroll Position to get correct trigger element position relative to scrollcontent\r\n            containerOffset[param] -= this._controller.scrollPos();\r\n          }\r\n\r\n          elementPos = elementOffset[param] - containerOffset[param];\r\n        } else { // there was an element, but it was removed from DOM\r\n          Log.log(2, 'WARNING: triggerElement was removed from DOM and will be reset to', undefined);\r\n          this.triggerElement(undefined); // unset, so a change event is triggered\r\n        }\r\n      }\r\n\r\n      const changed = elementPos !== this._triggerPos;\r\n      this._triggerPos = elementPos;\r\n      if (changed && !suppressEvents) {\r\n        this.trigger('shift', { reason: 'triggerElementPosition' });\r\n      }\r\n    }\r\n  }\r\n\r\n  _onContainerResize(event) {\r\n    if (this.options.triggerHook > 0) {\r\n      this.trigger('shift', { reason: 'containerResize' });\r\n    }\r\n  }\r\n\r\n  _validateOption(...check) {\r\n    check = check.length ? check : Object.keys(this.validate);\r\n    check.forEach((optionName) => {\r\n      let value;\r\n      if (this.validate[optionName]) { // there is a validation method for this option\r\n        try { // validate value\r\n          value = this.validate[optionName].call(this, this.options[optionName]);\r\n        } catch (event) { // validation failed -> reset to default\r\n          value = DEFAULT_SCENE_OPTIONS[optionName];\r\n          const logMSG = _.isString(event) ? [event] : event;\r\n          if (_.isArray(logMSG)) {\r\n            logMSG[0] = `ERROR: ${logMSG[0]}`;\r\n            logMSG.unshift(1); // loglevel 1 for error msg\r\n            Log.log.apply(this, logMSG);\r\n          } else {\r\n            Log.log(1, `ERROR: Problem executing validation callback for option '${optionName}':`, event.message);\r\n          }\r\n        } finally {\r\n          // this.options[optionName] = value;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  _changeOption(optionName, newVal) {\r\n    let changed = false;\r\n    const oldval = this.options[optionName];\r\n    if (this.options[optionName] !== newVal) {\r\n      this.options[optionName] = newVal;\r\n      this._validateOption(optionName); // resets to default if necessary\r\n      changed = oldval !== this.options[optionName];\r\n    }\r\n    return changed;\r\n  }\r\n\r\n  _addSceneOption(optionName) {\r\n    if (!this[optionName]) {\r\n      this[optionName] = (...args) => {\r\n        if (args.length === 0) { // get\r\n          return this.options[optionName];\r\n        }\r\n        if (optionName === 'duration') { // new duration is set, so any previously set function must be unset\r\n          this._durationUpdateMethod = null;\r\n        }\r\n        if (this._changeOption(optionName, args[0])) { // set\r\n          this.trigger('change', { what: optionName, newVal: this.options[optionName] });\r\n          if (SHIFTS.indexOf(optionName) > -1) {\r\n            this.trigger('shift', { reason: optionName });\r\n          }\r\n        }\r\n\r\n        return this;\r\n      };\r\n    }\r\n  }\r\n\r\n  controller() {\r\n    return this._controller;\r\n  }\r\n\r\n  state() {\r\n    return this._state;\r\n  }\r\n\r\n  scrollOffset() {\r\n    return this._scrollOffset.start;\r\n  }\r\n\r\n  triggerPosition() {\r\n    // the offset is the basis\r\n    let offset = _.isFunction(this.options.offset) ? this.options.offset() : this.options.offset;\r\n    if (this._controller) {\r\n      // get the trigger position\r\n      if (this.options.triggerElement) {\r\n        // Element as trigger\r\n        offset += this._triggerPos;\r\n      } else {\r\n        // return the height of the triggerHook to start at the beginning\r\n        offset += this._controller.info('size') * this.triggerHook();\r\n      }\r\n    }\r\n    return offset;\r\n  }\r\n\r\n  // pinning\r\n\r\n  _updatePinState(forceUnpin) {\r\n    if (this._pin && this._controller) {\r\n      const containerInfo = this._controller.info();\r\n      const pinTarget = this._pinOptions.spacer.firstChild; // may be pin element or another spacer, if cascading pins\r\n\r\n      if (!forceUnpin && this._state === SCENE_STATE_DURING) { // during scene or if duration is 0 and we are past the trigger\r\n        // pinned state\r\n        if (Util.css(pinTarget).position !== 'fixed') {\r\n          // change state before updating pin spacer (position changes due to fixed collapsing might occur.)\r\n          Util.css(pinTarget, { position: 'fixed' });\r\n          // update pin spacer\r\n          this._updatePinDimensions();\r\n        }\r\n\r\n        const fixedPos = Util.offset(this._pinOptions.spacer, true); // get viewport position of spacer\r\n        const scrollDistance = this.options.reverse || this.options.duration === 0 ?\r\n          containerInfo.scrollPos - this._scrollOffset.start // quicker\r\n          : Math.round(this._progress * this.options.duration * 10) / 10; // if no reverse and during pin the position needs to be recalculated using the progress\r\n\r\n        // add scrollDistance\r\n        fixedPos[containerInfo.vertical ? 'top' : 'left'] += scrollDistance;\r\n\r\n        // set new values\r\n        Util.css(this._pinOptions.spacer.firstChild, fixedPos);\r\n\r\n      } else {\r\n        // unpinned state\r\n        const newCSS = {\r\n          position: this._pinOptions.inFlow ? 'relative' : 'absolute',\r\n          top: 0,\r\n          left: 0,\r\n        };\r\n\r\n        let change = Util.css(pinTarget).position !== newCSS.position;\r\n\r\n        if (!this._pinOptions.pushFollowers) {\r\n          newCSS[containerInfo.vertical ? 'top' : 'left'] = this.options.duration * this._progress;\r\n\r\n        } else if (this.options.duration > 0) { // only concerns scenes with duration\r\n          if (this._state === SCENE_STATE_AFTER && parseFloat(Util.css(this._pinOptions.spacer).paddingTop) === 0) {\r\n            change = true; // if in after state but havent updated spacer yet (jumped past pin)\r\n          } else if (this._state === SCENE_STATE_BEFORE && parseFloat(Util.css(this._pinOptions.spacer).paddingBottom) === 0) { // before\r\n            change = true; // jumped past fixed state upward direction\r\n          }\r\n        }\r\n\r\n        // set new values\r\n        Util.css(pinTarget, newCSS);\r\n\r\n        if (change) {\r\n          // update pin spacer if state changed\r\n          this._updatePinDimensions();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  _updatePinDimensions() {\r\n    if (this._pin && this._controller && this._pinOptions.inFlow) {\r\n      // no spacer resize, if original position is absolute\r\n\r\n      const during = (this._state === SCENE_STATE_DURING);\r\n      const vertical = this._controller.info('vertical');\r\n      const pinTarget = this._pinOptions.spacer.firstChild; // usually the pined element but can also be another spacer (cascaded pins)\r\n      const marginCollapse = Util.marginCollapse(Util.css(this._pinOptions.spacer).display);\r\n\r\n      const css = {};\r\n\r\n      // set new size\r\n\r\n      // if relsize: spacer -> pin | else: pin -> spacer\r\n      if (this._pinOptions.relSize.width || this._pinOptions.relSize.autoFullWidth) {\r\n        if (during) {\r\n          Util.css(this._pin, { width: Util.width(this._pinOptions.spacer) });\r\n        } else {\r\n          Util.css(this._pin, { width: '100%' });\r\n        }\r\n\r\n      } else {\r\n        // minwidth is needed for cascaded pins.\r\n        css['min-width'] = Util.width(vertical ? this._pin : pinTarget, true, true);\r\n        css.width = during ? css['min-width'] : 'auto';\r\n      }\r\n\r\n      if (this._pinOptions.relSize.height) {\r\n        if (during) {\r\n          // the only padding the spacer should ever include is the duration (if pushFollowers = true), so we need to substract that.\r\n          Util.css(this._pin, { height: Util.height(this._pinOptions.spacer) - (this._pinOptions.pushFollowers ? this.options.duration : 0) });\r\n        } else {\r\n          Util.css(this._pin, { height: '100%' });\r\n        }\r\n\r\n      } else {\r\n        // margin is only included if it's a cascaded pin to resolve an IE9 bug\r\n        css['min-height'] = Util.height(vertical ? pinTarget : this._pin, true, !marginCollapse); // needed for cascading pins\r\n        css.height = during ? css['min-height'] : 'auto';\r\n      }\r\n\r\n      // add space for duration if pushFollowers is true\r\n      if (this._pinOptions.pushFollowers) {\r\n        css[`padding${vertical ? 'Top' : 'Left'}`] = this.options.duration * this._progress;\r\n        css[`padding${vertical ? 'Bottom' : 'Right'}`] = this.options.duration * (1 - this._progress);\r\n      }\r\n\r\n      Util.css(this._pinOptions.spacer, css);\r\n    }\r\n  }\r\n\r\n  _updatePinInContainer() {\r\n    if (this._controller && this._pin && this._state === SCENE_STATE_DURING && !this._controller.info('isDocument')) {\r\n      this._updatePinState();\r\n    }\r\n  }\r\n\r\n  _updateRelativePinSpacer() {\r\n    if (this._controller && this._pin &&\r\n      this._state === SCENE_STATE_DURING && // element in pinned state?\r\n      ( // is width or height relatively sized, but not in relation to body? then we need to recalc.\r\n        ((this._pinOptions.relSize.width || this._pinOptions.relSize.autoFullWidth) && Util.width(window) !== Util.width(this._pinOptions.spacer.parentNode)) ||\r\n        (this._pinOptions.relSize.height && Util.height(window) !== Util.height(this._pinOptions.spacer.parentNode))\r\n      )\r\n    ) {\r\n      this._updatePinDimensions();\r\n    }\r\n  }\r\n\r\n  _onMousewheelOverPin(event) {\r\n    if (this._controller && this._pin && this._state === SCENE_STATE_DURING && !this._controller.info('isDocument')) { // in pin state\r\n      event.preventDefault();\r\n      this._controller._setScrollPos(this._controller.info('scrollPos') - ((event.wheelDelta || event[this._controller.info('vertical') ? 'wheelDeltaY' : 'wheelDeltaX']) / 3 || -event.detail * 30));\r\n    }\r\n  }\r\n\r\n  setPin(element, settings) {\r\n    const defaultSettings = {\r\n      pushFollowers: true,\r\n      spacerClass: 'scrollwizardry-pin-spacer',\r\n    };\r\n\r\n    settings = _.merge({}, defaultSettings, settings);\r\n\r\n    // validate element\r\n    element = Util.elements(element)[0];\r\n\r\n    if (!element) {\r\n      Log.log(1, \"ERROR calling method 'setPin()': Invalid pin element supplied\");\r\n      return this; // cancel\r\n\r\n    } else if (Util.css(element).position === 'fixed') {\r\n      Log.log(1, \"ERROR calling method 'setPin()': Pin does not work with elements that are positioned 'fixed'\");\r\n      return this; // cancel\r\n    }\r\n\r\n    if (this._pin) { // preexisting pin?\r\n      if (this._pin === element) {\r\n        // same pin we already have -> do nothing\r\n        return this; // cancel\r\n      }\r\n      // kill old pin\r\n      this.removePin();\r\n    }\r\n    this._pin = element;\r\n\r\n    const parentDisplay = Util.css(this._pin.parentNode).display;\r\n    const boundsParams = ['top', 'left', 'bottom', 'right', 'margin', 'marginLeft', 'marginRight', 'marginTop', 'marginBottom'];\r\n\r\n    this._pin.parentNode.style.display = 'none'; // hack start to force css to return stylesheet values instead of calculated px values.\r\n\r\n    const inFlow = Util.css(this._pin).position !== 'absolute';\r\n    const pinCSS = _.pick(Util.css(this._pin), boundsParams.concat(['display']));\r\n    const sizeCSS = _.pick(Util.css(this._pin), ['width', 'height']);\r\n\r\n    this._pin.parentNode.style.display = parentDisplay; // hack end.\r\n\r\n    if (!inFlow && settings.pushFollowers) {\r\n      Log.log(2, 'WARNING: If the pinned element is positioned absolutely pushFollowers will be disabled.');\r\n      settings.pushFollowers = false;\r\n    }\r\n\r\n    // wait until all finished, because with responsive duration it will only be set after scene is added to controller\r\n    window.setTimeout(() => {\r\n      if (this._pin && this.options.duration === 0 && settings.pushFollowers) {\r\n        Log.log(2, 'WARNING: pushFollowers =', true, 'has no effect, when scene duration is 0.');\r\n      }\r\n    }, 0);\r\n\r\n    // create spacer and insert\r\n    const spacer = this._pin.parentNode.insertBefore(document.createElement('div'), this._pin);\r\n    const spacerCSS = _.merge(pinCSS, {\r\n      position: inFlow ? 'relative' : 'absolute',\r\n      boxSizing: 'content-box',\r\n      mozBoxSizing: 'content-box',\r\n      webkitBoxSizing: 'content-box',\r\n    });\r\n\r\n    if (!inFlow) { // copy size if positioned absolutely, to work for bottom/right positioned elements.\r\n      _.merge(spacerCSS, sizeCSS);\r\n    }\r\n\r\n    Util.css(spacer, spacerCSS);\r\n    spacer.setAttribute(PIN_SPACER_ATTRIBUTE, '');\r\n    spacer.classList.add(settings.spacerClass);\r\n\r\n    // set the pin Options\r\n    this._pinOptions = {\r\n      spacer,\r\n      relSize: { // save if size is defined using % values. if so, handle spacer resize differently...\r\n        width: sizeCSS.width.slice(-1) === '%',\r\n        height: sizeCSS.height.slice(-1) === '%',\r\n        autoFullWidth: sizeCSS.width === 'auto' && inFlow && Util.marginCollapse(pinCSS.display),\r\n      },\r\n      pushFollowers: settings.pushFollowers,\r\n      inFlow, // stores if the element takes up space in the document flow\r\n    };\r\n\r\n    if (!this._pin.___origStyle) {\r\n      this._pin.___origStyle = {};\r\n      const pinInlineStyle = this._pin.style;\r\n      const copyStyles = boundsParams.concat(['width', 'height', 'position', 'boxSizing', 'mozBoxSizing', 'webkitBoxSizing']);\r\n      copyStyles.forEach((val) => {\r\n        this._pin.___origStyle[val] = pinInlineStyle[val] || '';\r\n      });\r\n    }\r\n\r\n    // if relative size, transfer it to spacer and make pin calculate it...\r\n    if (this._pinOptions.relSize.width) {\r\n      Util.css(spacer, { width: sizeCSS.width });\r\n    }\r\n    if (this._pinOptions.relSize.height) {\r\n      Util.css(spacer, { height: sizeCSS.height });\r\n    }\r\n\r\n    // now place the pin element inside the spacer\r\n    spacer.appendChild(this._pin);\r\n    // and set new css\r\n    Util.css(this._pin, {\r\n      position: inFlow ? 'relative' : 'absolute',\r\n      margin: 'auto',\r\n      top: 'auto',\r\n      left: 'auto',\r\n      bottom: 'auto',\r\n      right: 'auto',\r\n    });\r\n\r\n    if (this._pinOptions.relSize.width || this._pinOptions.relSize.autoFullWidth) {\r\n      Util.css(this._pin, {\r\n        boxSizing: 'border-box',\r\n        mozBoxSizing: 'border-box',\r\n        webkitBoxSizing: 'border-box',\r\n      });\r\n    }\r\n\r\n    // add listener to document to update pin position in case controller is not the document.\r\n    window.addEventListener('scroll', this._updatePinInContainer.bind(this), { passive: true });\r\n    window.addEventListener('resize', this._updatePinInContainer.bind(this), { passive: true });\r\n    window.addEventListener('resize', this._updateRelativePinSpacer.bind(this), { passive: true });\r\n    // add mousewheel listener to catch scrolls over fixed elements\r\n    this._pin.addEventListener('mousewheel', this._onMousewheelOverPin.bind(this));\r\n    this._pin.addEventListener('DOMMouseScroll', this._onMousewheelOverPin.bind(this));\r\n\r\n    Log.log(3, 'added pin');\r\n\r\n    // finally update the pin to init\r\n    this._updatePinState();\r\n\r\n    return this;\r\n  }\r\n\r\n  removePin(reset) {\r\n    if (this._pin) {\r\n      if (this._state === SCENE_STATE_DURING) {\r\n        this._updatePinState(true); // force unpin at position\r\n      }\r\n      if (reset || !this._controller) { // if there's no controller no progress was made anyway...\r\n        const pinTarget = this._pinOptions.spacer.firstChild; // usually the pin element, but may be another spacer (cascaded pins)...\r\n        if (pinTarget.hasAttribute(PIN_SPACER_ATTRIBUTE)) { // copy margins to child spacer\r\n          const inlineStyle = this._pinOptions.spacer.style;\r\n          const values = ['margin', 'marginLeft', 'marginRight', 'marginTop', 'marginBottom'];\r\n          const margins = {};\r\n          values.forEach((val) => {\r\n            margins[val] = inlineStyle[val] || '';\r\n          });\r\n          Util.css(pinTarget, margins);\r\n        }\r\n        this._pinOptions.spacer.parentNode.insertBefore(pinTarget, this._pinOptions.spacer);\r\n        this._pinOptions.spacer.parentNode.removeChild(this._pinOptions.spacer);\r\n        if (!this._pin.parentNode.hasAttribute(PIN_SPACER_ATTRIBUTE)) { // if it's the last pin for this element -> restore inline styles\r\n          // TODO: only correctly set for first pin (when cascading) - how to fix?\r\n          Util.css(this._pin, this._pin.___origStyle);\r\n          delete this._pin.___origStyle;\r\n        }\r\n      }\r\n      window.removeEventListener('scroll', this._updatePinInContainer.bind(this), { passive: true });\r\n      window.removeEventListener('resize', this._updatePinInContainer.bind(this), { passive: true });\r\n      window.removeEventListener('resize', this._updateRelativePinSpacer.bind(this), { passive: true });\r\n      this._pin.removeEventListener('mousewheel', this._onMousewheelOverPin.bind(this));\r\n      this._pin.removeEventListener('DOMMouseScroll', this._onMousewheelOverPin.bind(this));\r\n      this._pin = null;\r\n      this._pinOptions.spacer = null;\r\n      Log.log(3, `removed pin (reset: ${reset ? 'true' : 'false'})`);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  // class toggle\r\n\r\n  setClassToggle(element, classes) {\r\n    const els = Util.elements(element);\r\n    if (els.length === 0 || !_.isString(classes)) {\r\n      Log.log(1, `ERROR calling method 'setClassToggle()': Invalid ${els.length === 0 ? 'element' : 'classes'} supplied.`);\r\n      return this;\r\n    }\r\n    if (this._cssClassElems.length > 0) {\r\n      // remove old ones\r\n      this.removeClassToggle();\r\n    }\r\n    this._cssClasses = classes;\r\n    this._cssClassElems = els;\r\n    this.on('enter.internal_class leave.internal_class', (event) => {\r\n      this._cssClassElems.forEach((el) => {\r\n        el.classList[event.type === 'enter' ? 'add' : 'remove'](this._cssClasses);\r\n      });\r\n    });\r\n    return this;\r\n  }\r\n\r\n  removeClassToggle(reset) {\r\n    if (reset) {\r\n      this._cssClassElems.forEach((el) => {\r\n        el.classList.remove(this._cssClasses);\r\n      });\r\n    }\r\n    this.off('start.internal_class end.internal_class');\r\n    this._cssClasses = null;\r\n    this._cssClassElems = [];\r\n    return this;\r\n  }\r\n\r\n  // gsap\r\n\r\n  _updateTweenProgress() {\r\n    if (this._tween) {\r\n      const progress = this.progress();\r\n      const state = this.state();\r\n      if (this._tween.repeat && this._tween.repeat() === -1) {\r\n        // infinite loop, so not in relation to progress\r\n        if (state === 'DURING' && this._tween.paused()) {\r\n          this._tween.play();\r\n        } else if (state !== 'DURING' && !this._tween.paused()) {\r\n          this._tween.pause();\r\n        }\r\n      } else if (progress !== this._tween.progress()) { // do we even need to update the progress?\r\n        // no infinite loop - so should we just play or go to a specific point in time?\r\n        if (this.duration() === 0) {\r\n          // play the animation\r\n          if (progress > 0) { // play from 0 to 1\r\n            this._tween.play();\r\n          } else { // play from 1 to 0\r\n            this._tween.reverse();\r\n          }\r\n        } else {\r\n          // go to a specific point in time\r\n          if (this.tweenChanges() && this._tween.tweenTo) {\r\n            // go smooth\r\n            this._tween.tweenTo(progress * this._tween.duration());\r\n          } else {\r\n            // just hard set it\r\n            this._tween.progress(progress).pause();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  setTween(TweenObject, duration, params) {\r\n    let newTween;\r\n    if (arguments.length > 1) {\r\n      if (arguments.length < 3) {\r\n        params = duration;\r\n        duration = 1;\r\n      }\r\n      TweenObject = window.TweenMax.to(TweenObject, duration, params);\r\n    }\r\n    try {\r\n      // wrap Tween into a Timeline Object if available to include delay and repeats in the duration and standardize methods.\r\n      if (window.TimelineMax) {\r\n        newTween = new window.TimelineMax({ smoothChildTiming: true }).add(TweenObject);\r\n      } else {\r\n        newTween = TweenObject;\r\n      }\r\n      newTween.pause();\r\n    } catch (event) {\r\n      Log.log(1, \"ERROR calling method 'setTween()': Supplied argument is not a valid TweenObject\");\r\n      return this;\r\n    }\r\n\r\n    if (this._tween) {\r\n      // kill old tween\r\n      this.removeTween();\r\n    }\r\n\r\n    this._tween = newTween;\r\n\r\n    // some properties need to be transferred it to the wrapper, otherwise they would get lost.\r\n    if (TweenObject.repeat && TweenObject.repeat() === -1) {\r\n      this._tween.repeat(-1);\r\n      this._tween.yoyo(TweenObject.yoyo());\r\n    }\r\n\r\n    Log.log(3, 'added tween');\r\n\r\n    this._updateTweenProgress();\r\n\r\n    return this;\r\n  }\r\n\r\n  removeTween(reset) {\r\n    if (this._tween) {\r\n      if (reset) {\r\n        this._tween.progress(0).pause();\r\n      }\r\n      this._tween.kill();\r\n      this._tween = null;\r\n      Log.log(3, `removed tween (reset: ${reset ? 'true' : 'false'})`);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  // indicators\r\n\r\n  addIndicators(options = {}) {\r\n    if (!this._indicator) {\r\n      this._indicator = new Indicator(this, options);\r\n\r\n      this.on('add.plugin_addIndicators', this._indicator.add.bind(this._indicator));\r\n      this.on('remove.plugin_addIndicators', this._indicator.remove.bind(this._indicator));\r\n      this.on('destroy.plugin_addIndicators', this.removeIndicators.bind(this));\r\n\r\n      // it the scene already has a controller we can start right away.\r\n      if (this.controller()) {\r\n        this._indicator.add();\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  removeIndicators() {\r\n    if (this._indicator) {\r\n      this._indicator.remove();\r\n      this.off('*.plugin_addIndicators');\r\n      this._indicator = null;\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\nexport default Scene;\r\n","/* eslint-env browser */\r\n\r\nimport _ from 'lodash';\r\nimport Util from './Util';\r\nimport Scene from './Scene';\r\nimport Log from './Log';\r\n\r\nconst PIN_SPACER_ATTRIBUTE = 'data-scrollwizardry-pin-spacer';\r\n\r\nconst NAMESPACE = 'ScrollWizardry.Controller';\r\n\r\nconst SCROLL_DIRECTION_FORWARD = 'FORWARD';\r\nconst SCROLL_DIRECTION_REVERSE = 'REVERSE';\r\nconst SCROLL_DIRECTION_PAUSED = 'PAUSED';\r\n\r\nconst EDGE_OFFSET = 15; // minimum edge distance, added to indentation\r\n\r\nclass Controller {\r\n  constructor(options) {\r\n    const DEFAULT_CONTROLLER_OPTIONS = {\r\n      container: window,\r\n      vertical: true,\r\n      globalSceneOptions: {},\r\n      loglevel: 2,\r\n      refreshInterval: 100,\r\n      addIndicators: false,\r\n    };\r\n\r\n    this.options = _.merge({}, DEFAULT_CONTROLLER_OPTIONS, options);\r\n\r\n    this.options.container = Util.elements(this.options.container)[0];\r\n\r\n    if (!this.options.container) {\r\n      Log.log(1, `ERROR creating object ${NAMESPACE}: No valid scroll container supplied`);\r\n      throw Error(`${NAMESPACE} init failed`);\r\n    }\r\n\r\n    this._isDocument = this.options.container === window || this.options.container === document.body || !document.body.contains(this.options.container);\r\n    this._sceneObjects = [];\r\n    this._updateScenesOnNextCycle = false;\r\n    this._scrollPos = 0;\r\n    this._scrollDirection = SCROLL_DIRECTION_PAUSED;\r\n    this._viewportSize = 0;\r\n    this._enabled = true;\r\n    this._updateTimeout = null;\r\n    this._refreshTimeout = null;\r\n\r\n    // normalize to window\r\n    if (this._isDocument) {\r\n      this.options.container = window;\r\n    }\r\n\r\n    // update container size immediately\r\n    this._viewportSize = this._getViewportSize();\r\n\r\n    // set event handlers\r\n    this.options.container.addEventListener('resize', this._onChange.bind(this), { passive: true });\r\n    this.options.container.addEventListener('scroll', this._onChange.bind(this), { passive: true });\r\n\r\n    const ri = parseInt(this.options.refreshInterval, 10);\r\n    this.options.refreshInterval = _.isNumber(ri) ? ri : DEFAULT_CONTROLLER_OPTIONS.refreshInterval;\r\n    this._scheduleRefresh();\r\n\r\n    // indicators\r\n    this._info = this.info();\r\n    this._container = this._info.container;\r\n    this._isDocument = this._info.isDocument;\r\n    this._vertical = this._info.vertical;\r\n    this._indicators = {\r\n      groups: [],\r\n    };\r\n\r\n    if (this.options.addIndicators) {\r\n      this._container.addEventListener('resize', this._handleTriggerPositionChange.bind(this), { passive: true });\r\n      if (!this._isDocument) {\r\n        window.addEventListener('resize', this._handleTriggerPositionChange.bind(this), { passive: true });\r\n        window.addEventListener('scroll', this._handleTriggerPositionChange.bind(this), { passive: true });\r\n      }\r\n      // update all related bounds containers\r\n      this._container.addEventListener('resize', this._handleBoundsPositionChange.bind(this), { passive: true });\r\n      this._container.addEventListener('scroll', this._handleBoundsPositionChange.bind(this), { passive: true });\r\n    }\r\n\r\n    Log.log(3, `added new ${NAMESPACE}`);\r\n  }\r\n\r\n  _scheduleRefresh() {\r\n    if (this.options.refreshInterval > 0) {\r\n      this._refreshTimeout = window.setTimeout(this._refresh.bind(this), this.options.refreshInterval);\r\n    }\r\n  }\r\n\r\n  _getScrollPos() {\r\n    return this.options.vertical ? Util.scrollTop(this.options.container) : Util.scrollLeft(this.options.container);\r\n  }\r\n\r\n  _getViewportSize() {\r\n    return this.options.vertical ? Util.height(this.options.container) : Util.width(this.options.container);\r\n  }\r\n\r\n  _setScrollPos(pos) {\r\n    if (this.options.vertical) {\r\n      if (this._isDocument) {\r\n        window.scrollTo(Util.scrollLeft(), pos);\r\n      } else {\r\n        this.options.container.scrollTop = pos;\r\n      }\r\n    } else if (this._isDocument) {\r\n      window.scrollTo(pos, Util.scrollTop());\r\n    } else {\r\n      this.options.container.scrollLeft = pos;\r\n    }\r\n  }\r\n\r\n  _updateScenes() {\r\n    if (this._enabled && this._updateScenesOnNextCycle) {\r\n      // determine scenes to update\r\n      const scenesToUpdate = _.isArray(this._updateScenesOnNextCycle) ? this._updateScenesOnNextCycle : this._sceneObjects.slice(0);\r\n\r\n      // reset scenes\r\n      this._updateScenesOnNextCycle = false;\r\n\r\n      const oldScrollPos = this._scrollPos;\r\n\r\n      // update scroll pos now instead of on change, as it might have changed since scheduling (i.e. in-browser smooth scroll)\r\n      this._scrollPos = this.scrollPos();\r\n\r\n      const deltaScroll = this._scrollPos - oldScrollPos;\r\n\r\n      if (deltaScroll !== 0) { // scroll position changed?\r\n        this._scrollDirection = (deltaScroll > 0) ? SCROLL_DIRECTION_FORWARD : SCROLL_DIRECTION_REVERSE;\r\n      }\r\n\r\n      // reverse order of scenes if scrolling reverse\r\n      if (this._scrollDirection === SCROLL_DIRECTION_REVERSE) {\r\n        scenesToUpdate.reverse();\r\n      }\r\n\r\n      // update scenes\r\n      scenesToUpdate.forEach((scene, index) => {\r\n        Log.log(3, `updating scene ${index + 1}/${scenesToUpdate.length} (${this._sceneObjects.length} total)`);\r\n        scene.update(true);\r\n      });\r\n\r\n      if (scenesToUpdate.length === 0 && this.options.loglevel >= 3) {\r\n        Log.log(3, 'updating 0 scenes (nothing added to controller)');\r\n      }\r\n    }\r\n  }\r\n\r\n  _debounceUpdate() {\r\n    this._updateTimeout = window.requestAnimationFrame(this._updateScenes.bind(this));\r\n  }\r\n\r\n  _onChange(event) {\r\n    Log.log(3, 'event fired causing an update:', event.type);\r\n    if (event.type === 'resize') {\r\n      // resize\r\n      this._viewportSize = this._getViewportSize();\r\n      this._scrollDirection = SCROLL_DIRECTION_PAUSED;\r\n    }\r\n    // schedule update\r\n    if (this._updateScenesOnNextCycle !== true) {\r\n      this._updateScenesOnNextCycle = true;\r\n      this._debounceUpdate();\r\n    }\r\n  }\r\n\r\n  _refresh() {\r\n    if (!this._isDocument) {\r\n      // simulate resize event, only works for viewport relevant param (performance)\r\n      if (this._viewportSize !== this._getViewportSize()) {\r\n        let resizeEvent;\r\n        try {\r\n          resizeEvent = new Event('resize', { bubbles: false, cancelable: false });\r\n        } catch (event) { // stupid IE\r\n          resizeEvent = document.createEvent('Event');\r\n          resizeEvent.initEvent('resize', false, false);\r\n        }\r\n        this.options.container.dispatchEvent(resizeEvent);\r\n      }\r\n    }\r\n\r\n    // refresh all scenes\r\n    this._sceneObjects.forEach((scene, index) => {\r\n      scene.refresh();\r\n    });\r\n\r\n    this._scheduleRefresh();\r\n  }\r\n\r\n  _sortScenes(scenesArray) {\r\n    if (scenesArray.length <= 1) {\r\n      return scenesArray;\r\n    }\r\n    const scenes = scenesArray.slice(0);\r\n    scenes.sort((a, b) => (a.scrollOffset() > b.scrollOffset() ? 1 : -1));\r\n    return scenes;\r\n  }\r\n\r\n  addScene(newScene) {\r\n    if (_.isArray(newScene)) {\r\n      newScene.forEach((scene) => {\r\n        this.addScene(scene);\r\n      });\r\n\r\n    } else if (newScene.controller() !== this) {\r\n      newScene.addTo(this);\r\n\r\n    } else if (!this._sceneObjects.includes(newScene)) {\r\n      this._sceneObjects.push(newScene);\r\n\r\n      this._sceneObjects = this._sortScenes(this._sceneObjects);\r\n\r\n      newScene.on('shift.controller_sort', () => { // resort whenever scene moves\r\n        this._sceneObjects = this._sortScenes(this._sceneObjects);\r\n      });\r\n\r\n      // insert global defaults\r\n      Object.keys(this.options.globalSceneOptions).forEach((key) => {\r\n        if (newScene[key]) {\r\n          newScene[key].call(newScene, this.options.globalSceneOptions[key]);\r\n        }\r\n      });\r\n\r\n      Log.log(3, `adding Scene (now ${this._sceneObjects.length} total)`);\r\n    }\r\n\r\n    // indicators\r\n    if (this.options.addIndicators) {\r\n      if (newScene instanceof Scene && newScene.controller() === this) {\r\n        newScene.addIndicators();\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  removeScene(scene) {\r\n    if (_.isArray(scene)) {\r\n      scene.forEach((_scene) => {\r\n        this.removeScene(_scene);\r\n      });\r\n\r\n    } else {\r\n      const index = this._sceneObjects.indexOf(scene);\r\n\r\n      if (index > -1) {\r\n        scene.off('shift.controller_sort');\r\n\r\n        this._sceneObjects.splice(index, 1);\r\n\r\n        Log.log(3, `removing Scene (now ${this._sceneObjects.length} left)`);\r\n\r\n        scene.remove();\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  updateScene(scene, immediately) {\r\n    if (_.isArray(scene)) {\r\n      scene.forEach((_scene) => {\r\n        this.updateScene(_scene, immediately);\r\n      });\r\n\r\n    } else if (immediately) {\r\n      scene.update(true);\r\n\r\n    // if this._updateScenesOnNextCycle is true, all connected scenes are already scheduled for update\r\n    } else if (this._updateScenesOnNextCycle !== true) {\r\n      // prep array for next update cycle\r\n      this._updateScenesOnNextCycle = this._updateScenesOnNextCycle || [];\r\n\r\n      if (this._updateScenesOnNextCycle.indexOf(scene) === -1) {\r\n        this._updateScenesOnNextCycle.push(scene);\r\n      }\r\n\r\n      this._updateScenesOnNextCycle = this._sortScenes(this._updateScenesOnNextCycle);\r\n\r\n      this._debounceUpdate();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  update(immediately) {\r\n    this._onChange({ type: 'resize' }); // will update size and set _updateScenesOnNextCycle to true\r\n\r\n    if (immediately) {\r\n      this._updateScenes();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  scrollTo(scrollTarget, additionalParameter) {\r\n    if (_.isNumber(scrollTarget)) {\r\n      this._setScrollPos.call(this.options.container, scrollTarget, additionalParameter);\r\n\r\n    } else if (_.isFunction(scrollTarget)) {\r\n      this._setScrollPos = scrollTarget;\r\n\r\n    } else if (_.isElement(scrollTarget)) {\r\n      // if parent is pin spacer, use spacer position instead\r\n      // so correct start position is returned for pinned elements\r\n      while (scrollTarget.parentNode.hasAttribute(PIN_SPACER_ATTRIBUTE)) {\r\n        scrollTarget = scrollTarget.parentNode;\r\n      }\r\n\r\n      const offset = this.options.vertical ? 'top' : 'left';\r\n\r\n      // container position is needed because element offset is returned in relation to document\r\n      // not in relation to container\r\n      const containerOffset = Util.offset(this.options.container);\r\n\r\n      const elementOffset = Util.offset(scrollTarget);\r\n\r\n      if (!this._isDocument) {\r\n        // container is not the document root, so substract scroll position\r\n        // to get correct trigger element position relative to scroll content\r\n        containerOffset[offset] -= this.scrollPos();\r\n      }\r\n\r\n      this.scrollTo(elementOffset[offset] - containerOffset[offset], additionalParameter);\r\n\r\n    } else if (scrollTarget instanceof Scene) {\r\n      if (scrollTarget.controller() === this) {\r\n        this.scrollTo(scrollTarget.scrollOffset(), additionalParameter);\r\n      } else {\r\n        Log.log(2, 'scrollTo(): The supplied scene does not belong to this controller, scroll cancelled', scrollTarget);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  scrollPos(scrollPosMethod) {\r\n    if (!arguments.length) {\r\n      return this._getScrollPos.call(this);\r\n    }\r\n\r\n    if (_.isFunction(scrollPosMethod)) {\r\n      this._getScrollPos = scrollPosMethod;\r\n    } else {\r\n      Log.log(2, 'Provided value for method \\'scrollPos()\\' is not a function, to change the current scroll position use \\'scrollTo()\\'');\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  info(about) {\r\n    const values = {\r\n      size: this._viewportSize,\r\n      vertical: this.options.vertical,\r\n      scrollPos: this._scrollPos,\r\n      scrollDirection: this._scrollDirection,\r\n      container: this.options.container,\r\n      isDocument: this._isDocument,\r\n    };\r\n\r\n    if (values[about] !== undefined) {\r\n      return values[about];\r\n    }\r\n\r\n    return values;\r\n  }\r\n\r\n  loglevel(newLoglevel) {\r\n    if (!arguments.length) {\r\n      return this.options.loglevel;\r\n\r\n    } else if (this.options.loglevel !== newLoglevel) {\r\n      this.options.loglevel = newLoglevel;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  enabled(newState) {\r\n    if (!arguments.length) {\r\n      return this._enabled;\r\n\r\n    } else if (this._enabled !== newState) {\r\n      this._enabled = !!newState;\r\n\r\n      this.updateScene(this._sceneObjects, true);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  destroy(resetScenes) {\r\n    window.clearTimeout(this._refreshTimeout);\r\n\r\n    this._sceneObjects.forEach(scene => scene.destroy(resetScenes));\r\n\r\n    this.options.container.removeEventListener('resize', this._onChange.bind(this), { passive: true });\r\n    this.options.container.removeEventListener('scroll', this._onChange.bind(this), { passive: true });\r\n\r\n    window.cancelAnimationFrame(this._updateTimeout);\r\n\r\n    Log.log(3, `destroyed ${NAMESPACE} (reset: ${resetScenes ? 'true' : 'false'})`);\r\n\r\n    // indicators\r\n    if (this.options.addIndicators) {\r\n      this._container.removeEventListener('resize', this._handleTriggerPositionChange.bind(this), { passive: true });\r\n      if (!this._isDocument) {\r\n        window.removeEventListener('resize', this._handleTriggerPositionChange.bind(this), { passive: true });\r\n        window.removeEventListener('scroll', this._handleTriggerPositionChange.bind(this), { passive: true });\r\n      }\r\n      this._container.removeEventListener('resize', this._handleBoundsPositionChange.bind(this), { passive: true });\r\n      this._container.removeEventListener('scroll', this._handleBoundsPositionChange.bind(this), { passive: true });\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  // indicators\r\n\r\n  // event handler for when associated bounds markers need to be repositioned\r\n  _handleBoundsPositionChange() {\r\n    this.updateBoundsPositions();\r\n  }\r\n\r\n  // event handler for when associated trigger groups need to be repositioned\r\n  _handleTriggerPositionChange() {\r\n    this.updateTriggerGroupPositions();\r\n\r\n    this._sceneObjects.forEach((scene, index) => {\r\n      if (scene._indicator) {\r\n        scene._indicator._updateBounds();\r\n      }\r\n    });\r\n  }\r\n\r\n  // updates the position of the bounds container to aligned to the right for vertical containers and to the bottom for horizontal\r\n  updateBoundsPositions(specificIndicator) {\r\n    // constant for all bounds\r\n    const groups = specificIndicator ?\r\n      [_.merge({}, specificIndicator.triggerGroup, { members: [specificIndicator] })] : // create a group with only one element\r\n      this._indicators.groups; // use all\r\n    let groupsCount = groups.length;\r\n    const pos = this._vertical ? 'left' : 'top';\r\n    const dimension = this._vertical ? 'width' : 'height';\r\n    const edge = this._vertical ?\r\n      Util.scrollLeft(this._container) + (Util.width(this._container) - EDGE_OFFSET) :\r\n      Util.scrollTop(this._container) + (Util.height(this._container) - EDGE_OFFSET);\r\n    let boundsCount;\r\n    let triggerSize;\r\n    let group;\r\n\r\n    while (groupsCount--) { // group loop\r\n      group = groups[groupsCount];\r\n      boundsCount = group.members.length;\r\n      triggerSize = Util[dimension](group.element.firstChild);\r\n\r\n      while (boundsCount--) { // indicators loop\r\n        const boundsCss = {};\r\n        boundsCss[pos] = edge - triggerSize;\r\n        Util.css(group.members[boundsCount].bounds, boundsCss);\r\n      }\r\n    }\r\n  }\r\n\r\n  // updates the positions of all trigger groups attached to a controller or a specific one, if provided\r\n  updateTriggerGroupPositions(specificGroup) {\r\n    // constant vars\r\n    const groups = specificGroup ? [specificGroup] : this._indicators.groups;\r\n    let i = groups.length;\r\n    const container = this._isDocument ? document.body : this._container;\r\n    const containerOffset = this._isDocument ? { top: 0, left: 0 } : Util.offset(container, true);\r\n    const edge = this._vertical ?\r\n      Util.width(this._container) - EDGE_OFFSET :\r\n      Util.height(this._container) - EDGE_OFFSET;\r\n    const dimension = this._vertical ? 'width' : 'height';\r\n    const transformAxis = this._vertical ? 'Y' : 'X';\r\n\r\n    // changing vars\r\n    let group;\r\n    let el;\r\n    let pos;\r\n    let elSize;\r\n    let transform;\r\n    while (i--) {\r\n      group = groups[i];\r\n      el = group.element;\r\n      pos = group.triggerHook * this.info('size');\r\n      elSize = Util[dimension](el.firstChild.firstChild);\r\n      transform = pos > elSize ? `translate${transformAxis}(-100%)` : '';\r\n\r\n      Util.css(el, {\r\n        top: containerOffset.top + (this._vertical ? pos : edge - group.members[0].options.indent),\r\n        left: containerOffset.left + (this._vertical ? edge - group.members[0].options.indent : pos),\r\n      });\r\n\r\n      Util.css(el.firstChild.firstChild, { transform });\r\n    }\r\n  }\r\n\r\n  // updates the label for the group to contain the name, if it only has one member\r\n  updateTriggerGroupLabel(group) {\r\n    const text = `trigger${group.members.length > 1 ? '' : ` ${group.members[0].options.name}`}`;\r\n    const elem = group.element.firstChild.firstChild;\r\n    const doUpdate = elem.textContent !== text;\r\n    if (doUpdate) {\r\n      elem.textContent = text;\r\n      if (this._vertical) { // bounds position is dependent on text length, so update\r\n        this.updateBoundsPositions();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default Controller;\r\n","/* eslint-env browser */\n\nimport Controller from './Controller';\nimport Scene from './Scene';\n\n// TODO: temporary workaround for chrome's scroll jitter bug\n// window.addEventListener('mousewheel', () => {}, { passive: true });\n\nexport {\n  Controller,\n  Scene,\n};\n"],"names":["Util","selector","_","isString","document","querySelectorAll","isElement","window","el","scrollTop","pageYOffset","scrollLeft","pageXOffset","innerWidth","getBoundingClientRect","width","innerHeight","height","relativeToViewport","offset","top","left","rect","display","includes","css","currentStyle","getComputedStyle","forEach","value","key","parseFloat","style","camelCase","Event","type","namespace","target","vars","currentTarget","timeStamp","Date","now","timestamp","DEBUG","LOG_LEVELS","Log","loglevel","length","time","getHours","slice","getMinutes","getSeconds","getMilliseconds","method","args","Array","prototype","splice","call","arguments","func","Function","bind","console","unshift","apply","FONT_SIZE","ZINDEX","TPL","color","inner","createElement","textContent","element","appendChild","zIndex","wrapper","_autoindex","Indicator","scene","options","DEFAULT_INDICATOR_OPTIONS","undefined","merge","name","_elemBounds","bounds","_elemStart","start","colorStart","_elemEnd","end","colorEnd","_boundsContainer","parent","elements","firstChild","_vertical","_ctrl","triggerGroup","controller","info","isDocument","body","position","on","_handleTriggerParamsChange","_handleBoundsParamsChange","_updateTriggerGroup","_updateBounds","updateBoundsPositions","log","off","members","group","indexOf","updateTriggerGroupLabel","updateTriggerGroupPositions","_removeTriggerGroup","_removeBounds","event","what","v","indent","parentNode","removeChild","_addBounds","triggerPosition","duration","triggerElem","trigger","colorTrigger","newGroup","triggerHook","_indicators","groups","push","closeEnough","Math","abs","i","_addTriggerGroup","PIN_SPACER_ATTRIBUTE","NAMESPACE","SCENE_STATE_BEFORE","SCENE_STATE_DURING","SCENE_STATE_AFTER","SHIFTS","DEFAULT_SCENE_OPTIONS","Scene","_state","_progress","_scrollOffset","_triggerPos","_durationUpdateMethod","_controller","_listeners","_pin","_pinOptions","_cssClasses","_cssClassElems","_tween","_indicator","keys","optionName","_addSceneOption","validate","val","match","perc","isFunction","error","isNumber","Error","translate","onCenter","onEnter","onLeave","max","min","parseInt","_validateOption","_updateTriggerElementPosition","update","durationChanged","reason","_updatePinState","_updatePinDimensions","removePin","reset","removeClassToggle","_updateTweenProgress","removeTween","names","callback","trim","split","fullname","nameparts","eventname","removeList","Object","remove","list","listener","listeners","removeScene","_updateDuration","_updateScrollOffset","addEventListener","_onContainerResize","passive","addScene","removeEventListener","tmpParent","triggerElement","immediately","enabled","scrollPos","newProgress","startPos","endPos","progress","updateScene","doUpdate","oldState","scrollDirection","reverseOrForward","reverse","eventVars","state","stateChanged","eventName","suppressEvents","varname","_changeOption","newVal","elementPos","telem","controllerInfo","containerOffset","container","param","vertical","hasAttribute","elementOffset","changed","check","logMSG","isArray","message","oldval","forceUnpin","containerInfo","pinTarget","spacer","fixedPos","scrollDistance","round","newCSS","inFlow","change","pushFollowers","paddingTop","paddingBottom","during","marginCollapse","relSize","autoFullWidth","preventDefault","_setScrollPos","wheelDelta","detail","settings","defaultSettings","parentDisplay","boundsParams","pinCSS","pick","concat","sizeCSS","setTimeout","insertBefore","spacerCSS","setAttribute","classList","add","spacerClass","___origStyle","pinInlineStyle","copyStyles","_updatePinInContainer","_updateRelativePinSpacer","_onMousewheelOverPin","inlineStyle","values","margins","classes","els","repeat","paused","play","pause","tweenChanges","tweenTo","TweenObject","params","newTween","TweenMax","to","TimelineMax","smoothChildTiming","yoyo","kill","removeIndicators","SCROLL_DIRECTION_FORWARD","SCROLL_DIRECTION_REVERSE","SCROLL_DIRECTION_PAUSED","EDGE_OFFSET","Controller","DEFAULT_CONTROLLER_OPTIONS","_isDocument","contains","_sceneObjects","_updateScenesOnNextCycle","_scrollPos","_scrollDirection","_viewportSize","_enabled","_updateTimeout","_refreshTimeout","_getViewportSize","_onChange","ri","refreshInterval","_scheduleRefresh","_info","_container","addIndicators","_handleTriggerPositionChange","_handleBoundsPositionChange","_refresh","pos","scrollTo","scenesToUpdate","oldScrollPos","deltaScroll","index","requestAnimationFrame","_updateScenes","_debounceUpdate","resizeEvent","bubbles","cancelable","createEvent","initEvent","dispatchEvent","refresh","scenesArray","scenes","sort","a","b","scrollOffset","newScene","addTo","_sortScenes","globalSceneOptions","_scene","scrollTarget","additionalParameter","scrollPosMethod","_getScrollPos","about","newLoglevel","newState","resetScenes","clearTimeout","destroy","cancelAnimationFrame","specificIndicator","groupsCount","dimension","edge","boundsCount","triggerSize","boundsCss","specificGroup","transformAxis","elSize","transform","text","elem"],"mappings":"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"}